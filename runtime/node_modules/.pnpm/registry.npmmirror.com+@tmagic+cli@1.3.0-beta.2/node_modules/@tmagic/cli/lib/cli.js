"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cli = void 0;
const cac_1 = require("cac");
const allowTs_1 = require("./utils/allowTs");
const logger_1 = require("./utils/logger");
const commands_1 = require("./commands");
/**
 * Wrap raw command to catch errors and exit process
 */
const wrapCommand = (cmd) => {
    const wrappedCommand = (...args) => cmd(...args).catch((err) => {
        (0, logger_1.error)(err.stack);
        process.exit(1);
    });
    return wrappedCommand;
};
/**
 * Vuepress cli
 */
const cli = (defaultAppConfig) => {
    // allow ts files globally
    (0, allowTs_1.allowTs)();
    // create cac instance
    const program = (0, cac_1.cac)('tmagic');
    // display core version and cli version
    const versionCli = require('../package.json').version;
    program.version(`tmagic/cli@${versionCli}`);
    // display help message
    program.help();
    // register `dev` command
    program.command('entry', 'Start development server').action(wrapCommand((0, commands_1.scripts)(defaultAppConfig)));
    program.parse(process.argv);
};
exports.cli = cli;
//# sourceMappingURL=cli.js.map