{"version":3,"file":"tmagic-data-source.umd.cjs","sources":["../src/util.ts","../src/data-sources/Base.ts","../src/data-sources/Http.ts","../src/DataSourceManager.ts","../src/createDataSourceManager.ts"],"sourcesContent":["/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2023 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DataSchema } from '@tmagic/schema';\n\nexport const getDefaultValueFromFields = (fields: DataSchema[]) => {\n  const data: Record<string, any> = {};\n\n  const defaultValue: Record<string, any> = {\n    string: '',\n    object: {},\n    array: [],\n    boolean: false,\n    number: 0,\n    null: null,\n    any: undefined,\n  };\n\n  fields.forEach((field) => {\n    if (typeof field.defaultValue !== 'undefined') {\n      data[field.name] = field.defaultValue;\n    } else if (field.type === 'object') {\n      data[field.name] = field.fields ? getDefaultValueFromFields(field.fields) : {};\n    } else if (field.type) {\n      data[field.name] = defaultValue[field.type];\n    } else {\n      data[field.name] = undefined;\n    }\n  });\n  return data;\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2023 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport EventEmitter from 'events';\n\nimport type { AppCore, CodeBlockContent, DataSchema } from '@tmagic/schema';\n\nimport type { DataSourceOptions } from '@data-source/types';\nimport { getDefaultValueFromFields } from '@data-source/util';\n\n/**\n * 静态数据源\n */\nexport default class DataSource extends EventEmitter {\n  public type = 'base';\n\n  public id: string;\n\n  public isInit = false;\n\n  public data: Record<string, any> = {};\n\n  public app: AppCore;\n\n  private fields: DataSchema[] = [];\n  private methods: CodeBlockContent[] = [];\n\n  constructor(options: DataSourceOptions) {\n    super();\n\n    this.app = options.app;\n    this.id = options.schema.id;\n    this.setFields(options.schema.fields);\n    this.setMethods(options.schema.methods || []);\n\n    this.updateDefaultData();\n  }\n\n  public setFields(fields: DataSchema[]) {\n    this.fields = fields;\n  }\n\n  public setMethods(methods: CodeBlockContent[]) {\n    this.methods = methods;\n  }\n\n  public getMethods() {\n    return this.methods;\n  }\n\n  public setData(data: Record<string, any>) {\n    // todo: 校验数据，看是否符合 schema\n    this.data = data;\n    this.emit('change');\n  }\n\n  public getDefaultData() {\n    return getDefaultValueFromFields(this.fields);\n  }\n\n  public updateDefaultData() {\n    this.setData(this.getDefaultData());\n  }\n\n  public async init() {\n    this.isInit = true;\n  }\n\n  public destroy() {\n    this.data = {};\n    this.fields = [];\n    this.removeAllListeners();\n  }\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2023 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { HttpOptions, RequestFunction } from '@tmagic/schema';\nimport { getValueByKeyPath } from '@tmagic/utils';\n\nimport { HttpDataSourceOptions, HttpDataSourceSchema } from '@data-source/types';\n\nimport DataSource from './Base';\n\n/**\n * 将json对象转换为urlencoded字符串\n * @param data json对象\n * @returns string\n */\nconst urlencoded = (data: Record<string, string | number | boolean | null | undefined>) =>\n  Object.entries(data).reduce((prev, [key, value]) => {\n    let v = value;\n    if (typeof value === 'object') {\n      v = JSON.stringify(value);\n    }\n    if (typeof value !== 'undefined') {\n      return `${prev}${prev ? '&' : ''}${globalThis.encodeURIComponent(key)}=${globalThis.encodeURIComponent(`${v}`)}`;\n    }\n    return prev;\n  }, '');\n\n/**\n * 浏览器端请求\n * 如果未有自定义的request方法，则使用浏览器的fetch方法\n * @param options 请求参数\n */\nconst webRequest = async (options: HttpOptions) => {\n  const { url, method = 'GET', headers = {}, params = {}, data = {}, ...config } = options;\n  const query = urlencoded(params);\n  let body: string = JSON.stringify(data);\n  if (headers['Content-Type']?.includes('application/x-www-form-urlencoded')) {\n    body = urlencoded(data);\n  }\n\n  const response = await globalThis.fetch(query ? `${url}?${query}` : url, {\n    method,\n    headers,\n    body: method === 'GET' ? undefined : body,\n    ...config,\n  });\n\n  return response.json();\n};\n\n/**\n * Http 数据源\n * @description 通过 http 请求获取数据\n */\nexport default class HttpDataSource extends DataSource {\n  public type = 'http';\n\n  public isLoading = false;\n  public error?: {\n    msg?: string;\n    code?: string | number;\n  };\n  public schema: HttpDataSourceSchema;\n  public httpOptions: HttpOptions;\n\n  private fetch?: RequestFunction;\n  private beforeRequest: ((...args: any[]) => any)[] = [];\n  private afterRequest: ((...args: any[]) => any)[] = [];\n\n  constructor(options: HttpDataSourceOptions) {\n    const { options: httpOptions, ...dataSourceOptions } = options.schema;\n\n    super({\n      schema: dataSourceOptions,\n      app: options.app,\n    });\n\n    this.schema = options.schema;\n    this.httpOptions = httpOptions;\n\n    if (typeof options.request === 'function') {\n      this.fetch = options.request;\n    } else if (typeof globalThis.fetch === 'function') {\n      this.fetch = webRequest;\n    }\n\n    this.getMethods().forEach((method) => {\n      if (typeof method.content !== 'function') return;\n      if (method.timing === 'beforeRequest') {\n        this.beforeRequest.push(method.content);\n      }\n      if (method.timing === 'afterRequest') {\n        this.afterRequest.push(method.content);\n      }\n    });\n  }\n\n  public async init() {\n    if (this.schema.autoFetch) {\n      await this.request(this.httpOptions);\n    }\n\n    super.init();\n  }\n\n  public async request(options: HttpOptions) {\n    try {\n      for (const method of this.beforeRequest) {\n        await method({ options, params: {}, dataSource: this, app: this.app });\n      }\n\n      const res = await this.fetch?.({\n        ...this.httpOptions,\n        ...options,\n      });\n\n      for (const method of this.afterRequest) {\n        await method({ res, options, params: {}, dataSource: this, app: this.app });\n      }\n\n      if (this.schema.responseOptions?.dataPath) {\n        const data = getValueByKeyPath(this.schema.responseOptions.dataPath, res);\n        this.setData(data);\n      } else {\n        this.setData(res);\n      }\n\n      this.error = undefined;\n    } catch (error: any) {\n      this.error = {\n        msg: error.message,\n      };\n\n      this.emit('error', error);\n    }\n  }\n\n  public get(options: Partial<HttpOptions> & { url: string }) {\n    return this.request({\n      ...options,\n      method: 'GET',\n    });\n  }\n\n  public post(options: Partial<HttpOptions> & { url: string }) {\n    return this.request({\n      ...options,\n      method: 'POST',\n    });\n  }\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2023 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport EventEmitter from 'events';\n\nimport { cloneDeep, template } from 'lodash-es';\n\nimport type { AppCore, DataSourceSchema, Id, MNode } from '@tmagic/schema';\nimport { compiledCond, compiledNode } from '@tmagic/utils';\n\nimport { DataSource, HttpDataSource } from './data-sources';\nimport type { DataSourceManagerData, DataSourceManagerOptions, HttpDataSourceSchema } from './types';\n\nclass DataSourceManager extends EventEmitter {\n  private static dataSourceClassMap = new Map<string, typeof DataSource>();\n\n  public static registe(type: string, dataSource: typeof DataSource) {\n    DataSourceManager.dataSourceClassMap.set(type, dataSource);\n  }\n\n  public static getDataSourceClass(type: string) {\n    return DataSourceManager.dataSourceClassMap.get(type);\n  }\n\n  public app: AppCore;\n\n  public dataSourceMap = new Map<string, DataSource>();\n\n  public data: DataSourceManagerData = {};\n\n  constructor({ app }: DataSourceManagerOptions) {\n    super();\n\n    this.app = app;\n\n    app.dsl?.dataSources?.forEach((config) => {\n      this.addDataSource(config);\n    });\n  }\n\n  public get(id: string) {\n    return this.dataSourceMap.get(id);\n  }\n\n  public async addDataSource(config?: DataSourceSchema) {\n    if (!config) return;\n\n    let ds: DataSource;\n    if (config.type === 'http') {\n      ds = new HttpDataSource({\n        app: this.app,\n        schema: config as HttpDataSourceSchema,\n        request: this.app.request,\n      });\n    } else {\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      const DataSourceClass = DataSourceManager.dataSourceClassMap.get(config.type) || DataSource;\n\n      ds = new DataSourceClass({\n        app: this.app,\n        schema: config,\n      });\n    }\n\n    this.dataSourceMap.set(config.id, ds);\n\n    this.data[ds.id] = ds.data;\n\n    const beforeInit: ((...args: any[]) => any)[] = [];\n    const afterInit: ((...args: any[]) => any)[] = [];\n\n    ds.getMethods().forEach((method) => {\n      if (typeof method.content !== 'function') return;\n      if (method.timing === 'beforeInit') {\n        beforeInit.push(method.content);\n      }\n      if (method.timing === 'afterInit') {\n        afterInit.push(method.content);\n      }\n    });\n\n    for (const method of beforeInit) {\n      await method({ params: {}, dataSource: ds, app: this.app });\n    }\n\n    await ds.init();\n\n    for (const method of afterInit) {\n      await method({ params: {}, dataSource: ds, app: this.app });\n    }\n\n    this.setData(ds);\n\n    ds.on('change', () => {\n      this.setData(ds);\n    });\n  }\n\n  public setData(ds: DataSource) {\n    Object.assign(this.data[ds.id], ds.data);\n    this.emit('change', ds.id);\n  }\n\n  public removeDataSource(id: string) {\n    this.get(id)?.destroy();\n    delete this.data[id];\n    this.dataSourceMap.delete(id);\n  }\n\n  public updateSchema(schemas: DataSourceSchema[]) {\n    schemas.forEach((schema) => {\n      const ds = this.dataSourceMap.get(schema.id);\n      if (!ds) {\n        return;\n      }\n      ds.setFields(schema.fields);\n      ds.updateDefaultData();\n      this.data[ds.id] = ds.data;\n    });\n  }\n\n  public compiledNode(node: MNode, sourceId?: Id) {\n    if (node.condResult === false) return node;\n    if (node.visible === false) return node;\n\n    return compiledNode(\n      (value: any) => {\n        if (typeof value === 'string') {\n          return template(value)(this.data);\n        }\n        if (value?.isBindDataSource && value.dataSourceId) {\n          return this.data[value.dataSourceId];\n        }\n        return value;\n      },\n      cloneDeep(node),\n      this.app.dsl?.dataSourceDeps || {},\n      sourceId,\n    );\n  }\n\n  public compliedConds(node: MNode) {\n    if (!node.displayConds || !Array.isArray(node.displayConds) || !node.displayConds.length) return true;\n\n    for (const { cond } of node.displayConds) {\n      if (!cond) continue;\n\n      let result = true;\n      for (const { op, value, range, field } of cond) {\n        const [sourceId, fieldKey] = field;\n\n        const dsData = this.data[sourceId];\n\n        if (!dsData || !fieldKey) {\n          break;\n        }\n\n        const fieldValue = dsData[fieldKey];\n        if (!compiledCond(op, fieldValue, value, range)) {\n          result = false;\n          break;\n        }\n      }\n\n      if (result) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public destroy() {\n    this.removeAllListeners();\n    this.data = {};\n    this.dataSourceMap.forEach((ds) => {\n      ds.destroy();\n    });\n    this.dataSourceMap = new Map();\n  }\n}\n\nexport default DataSourceManager;\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2023 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { cloneDeep, union } from 'lodash-es';\n\nimport type { AppCore } from '@tmagic/schema';\nimport { getDepNodeIds, getNodes, replaceChildNode } from '@tmagic/utils';\n\nimport DataSourceManager from './DataSourceManager';\n\n/**\n * 创建数据源管理器\n * @param dsl DSL\n * @param httpDataSourceOptions http 数据源配置\n * @returns DataSourceManager\n */\nexport const createDataSourceManager = (app: AppCore) => {\n  const { dsl, platform } = app;\n  if (!dsl?.dataSources) return;\n\n  const dataSourceManager = new DataSourceManager({ app });\n\n  if (dsl.dataSources && dsl.dataSourceCondDeps && platform !== 'editor') {\n    getNodes(getDepNodeIds(dsl.dataSourceCondDeps), dsl.items).forEach((node) => {\n      node.condResult = dataSourceManager.compliedConds(node);\n      replaceChildNode(node, dsl!.items);\n    });\n  }\n\n  if (dsl.dataSources && dsl.dataSourceDeps) {\n    getNodes(getDepNodeIds(dsl.dataSourceDeps), dsl.items).forEach((node) => {\n      replaceChildNode(dataSourceManager.compiledNode(node), dsl!.items);\n    });\n  }\n\n  dataSourceManager.on('change', (sourceId: string) => {\n    const dep = dsl.dataSourceDeps?.[sourceId] || {};\n    const condDep = dsl.dataSourceCondDeps?.[sourceId] || {};\n\n    const nodeIds = union([...Object.keys(condDep), ...Object.keys(dep)]);\n\n    dataSourceManager.emit(\n      'update-data',\n      getNodes(nodeIds, dsl.items).map((node) => {\n        const newNode = cloneDeep(node);\n        newNode.condResult = dataSourceManager.compliedConds(node);\n        return dataSourceManager.compiledNode(newNode);\n      }),\n      sourceId,\n    );\n  });\n\n  return dataSourceManager;\n};\n"],"names":["getValueByKeyPath","compiledNode","template","cloneDeep","compiledCond","DataSourceManager","getNodes","getDepNodeIds","replaceChildNode","union"],"mappings":"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"}